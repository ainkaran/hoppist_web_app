cd /Users/alextaylor/Documents/CodeCore/hoppist/hoppist_web_app

# run tests
echo "--- Running rspec tests..."
bundle exec rspec

echo "--- Running JS tests..."
cd app/react; npm run test

if [ $? -eq 0 ]
  then
  echo "--- All tests passed! Deploying..."

  # Delete local assets in order to force compilation on Heroku
  rm -rvf /Users/alextaylor/Documents/CodeCore/hoppist/hoppist_web_app/public/assets

  cd /Users/alextaylor/Documents/CodeCore/hoppist/hoppist_web_app
  # Git push
  git push origin staging

  # Heroku deployment
  git push staging staging:master
  heroku run rake db:migrate --app hoppist-staging

  # Test 'er out!
  open "http://hoppist-staging.herokuapp.com"
else
  echo "** Deployment halted due to failed tests."
fi
